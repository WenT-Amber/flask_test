{% extends "base.html" %}
{% block title %}自動化測試{% endblock %}
{%block head %}
{{ super() }}
<style type="text/css">
    #game_code,#game_type{border-radius: 22px;}
    li{list-style: none;}
    p{margin-top: 1%;}
    span{color: red;}
</style>
{% endblock %}
{% block script %}
    <script type="text/javascript">
        var game_detail="";
        function check(){
            if ($('.dataframe').length>0){
                $('.dataframe').remove();
            }
            if($("#game_code").val() =="" && $("#game_type").val()=="" ){//判斷倆著皆不能輸入
                alert("請選擇單一輸入框");
                return false;
            }
            else if ($("#game_code").val() !="" && $("#game_type").val()!="" ){//判斷倆著皆輸入
                alert("只能擇一輸入框");
                return false;
            }
            else {
                $('#submit').attr('disabled','true');
                myajax  = $.ajax({ 
                url:"/game_result",
                type:"POST",
                //dataType: "json",
                headers:{
                        Accept:"application/json; charset=utf-8"
                    },
                data:$("#form1").serialize(),
                success:function(data){
                    game_detail = data;
                    //console.log(data);
                    if (data=='此環境沒有此訂單號'){
                        alert(data);
                        return false;
                    }
                    else {
                        $('#game_detail').after(data);
                        pretty("body > main > table > tbody > tr > td:nth-child(8)",'#')//理論獎金
                        pretty("body > main > table > tbody > tr > td:nth-last-child(1)",'#')//遊戲說明
                    }
                    $('#submit').removeAttr('disabled');
                    }
                    })
                    $.when(myajax).done(function (){
                    $.ajax({
                    url: "/get_cookie",
                    type: "GET",
                    data: {'env_type':  $("#env_type").val()},
                    success:function(data){
                        //console.log(data)
                        $.cookie($("#env_type").val(), data)
                    }

                    })
                
                        })
                }
                }
    </script>
{% endblock %}
{% block main %}
    <form id='form1' method='POST'>
        <label>環境: </label>
        <select name='env_type' id='env_type'>
            <option value="dev02">dev02</option>
            <option value="joy188">joy188</option>
        </select>
        <br>
        請輸入遊戲單號<input type="text" id="game_code" name="game_code"
            size="20">
        </br>    
        請輸入遊戲玩法<input type="text" id="game_type" name="game_type"
            size="20" placeholder="請輸入簡體" >
        <p><input type="button" onclick="check()"id=submit value="查詢" title="最近一個月內"></p>
    </form>
    <div id='game_detail'>
    </div> 
{% endblock %}